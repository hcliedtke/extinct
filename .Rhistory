View(recordings)
View(surveys)
# data for passive surveys
#data for passive surveys
pi = c(0.06, 0.14)
eps.passive = c(0.01,	0.05)
pi.passive = c(0.7,	0.95)
pr.passive = c(0.7,	0.95)
pas.sur = c(eps.passive ,pi.passive,pr.passive)
#total number of years
years = seq(min(recordings[,'year'],surveys[,'year']),max(recordings[,'year'],surveys[,'year']),by =
1)
Total.years = length(years)
#add passive surveys to the surveys
pas.sur.years = years[!years %in% surveys[,1] &
!years %in% recordings[,1]] #find years without either surveys or recordings
pas.surveys = cbind(pas.sur.years,t(replicate(length(pas.sur.years), pas.sur)))
colnames(pas.surveys) = names(surveys)
surveys = rbind(surveys,pas.surveys)
rec.year = cbind(recordings[,'year'],1) #whether a recording was made this year
rec.year = rbind(rec.year,cbind(surveys[,'year'],0))
rec.year = rec.year[order(rec.year[,1]),]
PXt= px.mid() ### NOTE: FIRST SURVEY YEAR NEEDS TO OCCUR AFTER THE FIRST RECORD!!!
# data for passive surveys
#data for passive surveys
pi = c(0.06, 0.14)
eps.passive = c(0.01,	0.05)
pi.passive = c(0.7,	0.95)
pr.passive = c(0.7,	0.95)
pas.sur = c(eps.passive ,pi.passive,pr.passive)
#total number of years
years = seq(min(recordings[,'year'],surveys[,'year']),max(recordings[,'year'],surveys[,'year']),by =
1)
Total.years = length(years)
#add passive surveys to the surveys
pas.sur.years = years[!years %in% surveys[,1] &
!years %in% recordings[,1]] #find years without either surveys or recordings
pas.surveys = cbind(pas.sur.years,t(replicate(length(pas.sur.years), pas.sur)))
colnames(pas.surveys) = names(surveys)
# set species working directoryD
setwd("~/Documents/git_projects/extinct/")
# load functions
source("./_functions_thompson_et_al.R")
# load data files for recordings and surveys
recordings <- read.csv("./c_maridadi/recordings.csv")
surveys <- read.csv("./c_maridadi/surveys.csv")
# data for passive surveys
#data for passive surveys
pi = c(0.06, 0.14)
eps.passive = c(0.01,	0.05)
pi.passive = c(0.7,	0.95)
pr.passive = c(0.7,	0.95)
pas.sur = c(eps.passive ,pi.passive,pr.passive)
#total number of years
years = seq(min(recordings[,'year'],surveys[,'year']),max(recordings[,'year'],surveys[,'year']),by =
1)
Total.years = length(years)
#add passive surveys to the surveys
pas.sur.years = years[!years %in% surveys[,1] &
!years %in% recordings[,1]] #find years without either surveys or recordings
pas.surveys = cbind(pas.sur.years,t(replicate(length(pas.sur.years), pas.sur)))
colnames(pas.surveys) = names(surveys)
surveys = rbind(surveys,pas.surveys)
rec.year = cbind(recordings[,'year'],1) #whether a recording was made this year
rec.year = rbind(rec.year,cbind(surveys[,'year'],0))
rec.year = rec.year[order(rec.year[,1]),]
PXt= px.mid() ### NOTE: FIRST SURVEY YEAR NEEDS TO OCCUR AFTER THE FIRST RECORD!!!
# Plot the results -----------------------------
xx <- c(years, rev(years))
yysd=c( PXt[,1],rev(PXt[,3]))
yyint=c( PXt[,4],rev(PXt[,5]))
par(family="serif")
plot(
years,PXt[,2], "l",ylim = c(0,1), xaxt = 'n',xaxs = "i", yaxs = "i" ,xlab =
"Years", ylab = "P(X|t)"
)
polygon(xx, yyint, col = 'lightgrey', border = NA)
polygon(xx, yysd, col = 'darkgrey', border = NA)
lines(years,PXt[,2], "l")
axis(1, at = seq(min(years), max(years), by = 3), las = 2)
axis(1, at = c(min(years), max(years)), las = 2)
# Table of results -----------------------------
# PXt = cbind(years,PXt.min,PXt.mid,PXt.max)
PXt = cbind(years,PXt)
print (PXt)
xx
yyint
library(tidyverse)
# set species working directory
setwd("~/Documents/git_projects/extinct/")
library(tidyverse)
# load functions
source("./_functions_thompson_et_al.R")
# load data files for recordings and surveys
recordings <- read_csv("./c_maridadi/recordings.csv")
surveys <- read_csv("./c_maridadi/surveys.csv")
# data for passive surveys
#data for passive surveys
pi = c(0.06, 0.14)
eps.passive = c(0.01,	0.05)
pi.passive = c(0.7,	0.95)
pr.passive = c(0.7,	0.95)
pas.sur = c(eps.passive ,pi.passive,pr.passive)
pas.sur
View(px.mid)
px.mid
# load functions
source("./_functions_thompson_et_al.R")
# load data files for recordings and surveys
recordings <- read.csv("./c_maridadi/recordings.csv")
surveys <- read.csv("./c_maridadi/surveys.csv")
# data for passive surveys
#data for passive surveys
pi = c(0.06, 0.14)
eps.passive = c(0.01,	0.05)
pi.passive = c(0.7,	0.95)
pr.passive = c(0.7,	0.95)
pas.sur = c(eps.passive ,pi.passive,pr.passive)
#total number of years
years = seq(min(recordings[,'year'],surveys[,'year']),max(recordings[,'year'],surveys[,'year']),by =
1)
Total.years = length(years)
#add passive surveys to the surveys
pas.sur.years = years[!years %in% surveys[,1] &
!years %in% recordings[,1]] #find years without either surveys or recordings
pas.surveys = cbind(pas.sur.years,t(replicate(length(pas.sur.years), pas.sur)))
colnames(pas.surveys) = names(surveys)
surveys = rbind(surveys,pas.surveys)
rec.year = cbind(recordings[,'year'],1) # whether a recording was made this year
rec.year = rbind(rec.year,cbind(surveys[,'year'],0))
rec.year = rec.year[order(rec.year[,1]),]
PXt= px.mid() ### NOTE: FIRST SURVEY YEAR NEEDS TO OCCUR AFTER THE FIRST RECORD!!!
PXt= px.mid(recordings=recordings) ### NOTE: FIRST SURVEY YEAR NEEDS TO OCCUR AFTER THE FIRST RECORD!!!
#add passive surveys to the surveys
pas.sur.years = years[!years %in% surveys[,1] &
!years %in% recordings[,1]] #find years without either surveys or recordings
pas.sur.years
# load data files for recordings and surveys
recordings <- read_csv("./c_maridadi/recordings.csv")
surveys <- read_csv("./c_maridadi/surveys.csv")
# set species working directory
setwd("~/Documents/git_projects/extinct/")
library(tidyverse)
# load functions
source("./_functions_thompson_et_al.R")
# load data files for recordings and surveys
recordings <- read_csv("./c_maridadi/recordings.csv")
surveys <- read_csv("./c_maridadi/surveys.csv")
#add passive surveys to the surveys
pas.sur.years = years[!years %in% surveys[,1] &
!years %in% recordings[,1]] #find years without either surveys or recordings
pas.sur.years
surveys
# load data files for recordings and surveys
recordings <- read_csv("./c_maridadi/recordings.csv")
View(recordings)
View(surveys)
#total number of years
years = seq(min(recordings[,'year'],surveys[,'year']),max(recordings[,'year'],surveys[,'year']),by =
1)
Total.years = length(years)
#add passive surveys to the surveys
pas.sur.years = years[!years %in% surveys[,1] &
!years %in% recordings[,1]] #find years without either surveys or recordings
pas.surveys = cbind(pas.sur.years,t(replicate(length(pas.sur.years), pas.sur)))
pas.surveys
#add passive surveys to the surveys
pas.sur.years = years[!years %in% surveys[,1] &
!years %in% recordings[,1]] #find years without either surveys or recordings
pas.surveys = cbind(pas.sur.years,t(replicate(length(pas.sur.years), pas.sur)))
pas.sur = c(eps.passive ,pi.passive,pr.passive)
# data for passive surveys
#data for passive surveys
pi = c(0.06, 0.14)
eps.passive = c(0.01,	0.05)
pi.passive = c(0.7,	0.95)
pr.passive = c(0.7,	0.95)
pas.sur = c(eps.passive ,pi.passive,pr.passive)
#total number of years
years = seq(min(recordings[,'year'],surveys[,'year']),max(recordings[,'year'],surveys[,'year']),by =
1)
Total.years = length(years)
#add passive surveys to the surveys
pas.sur.years = years[!years %in% surveys[,1] &
!years %in% recordings[,1]] #find years without either surveys or recordings
pas.surveys = cbind(pas.sur.years,t(replicate(length(pas.sur.years), pas.sur)))
pas.surveys
View(pas.surveys)
min(recordings$year, surveys$year):max(recordings$year, surveys$year)
pas.sur
passive_surveys<- date_frame(
years = min(recordings$year, surveys$year):max(recordings$year, surveys$year),
eps_min=0.01,
eps_max=0.05,
pi_min=0.7,
pi_max=0.95,
pr_min=0.7,
pr_max=0.95
)
passive_surveys<- date_frame(
years = min(recordings$year, surveys$year):max(recordings$year, surveys$year),
eps_min=0.01,
eps_max=0.05,
pi_min=0.7,
pi_max=0.95,
pr_min=0.7,
pr_max=0.95
)
passive_surveys<- data_frame(
years = min(recordings$year, surveys$year):max(recordings$year, surveys$year),
eps_min=0.01,
eps_max=0.05,
pi_min=0.7,
pi_max=0.95,
pr_min=0.7,
pr_max=0.95
)
passive_surveys<- tibble(
years = min(recordings$year, surveys$year):max(recordings$year, surveys$year),
eps_min=0.01,
eps_max=0.05,
pi_min=0.7,
pi_max=0.95,
pr_min=0.7,
pr_max=0.95
)
passive_surveys
passive_surveys<- tibble(
years = min(recordings$year, surveys$year):max(recordings$year, surveys$year),
eps_min=0.01,
eps_max=0.05,
pi_min=0.7,
pi_max=0.95,
pr_min=0.7,
pr_max=0.95
)
colnames(pas.surveys) = names(surveys)
pas.surveys
surveys
min(recordings$year, surveys$year):max(recordings$year, surveys$year)
min(recordings$year, surveys$year):max(recordings$year, surveys$year)
recordings$year
c(recordings$year, surveys$year)
passive_surveys<- tibble(
years = min(recordings$year, surveys$year):max(recordings$year, surveys$year),
eps_lower=0.01,
eps_upper=0.05,
pi_lower=0.7,
pi_upper=0.95,
pr_lower=0.7,
pr_upper=0.95
)
passive_surveys %>%
filter(!years %in% c(recordings$year, surveys$year))
recordings
passive_surveys %>%
filter(!years %in% c(recordings$year, surveys$year)) %>%
bind_rows(surveys)
passive_surveys<- tibble(
year = min(recordings$year, surveys$year):max(recordings$year, surveys$year),
eps_lower=0.01,
eps_upper=0.05,
pi_lower=0.7,
pi_upper=0.95,
pr_lower=0.7,
pr_upper=0.95
)
passive_surveys %>%
filter(!year %in% c(recordings$year, surveys$year)) %>%
bind_rows(surveys)
passive_surveys %>%
filter(!year %in% c(recordings$year, surveys$year)) %>%
bind_rows(surveys) %>%
arrange(year)
passive_surveys %>%
filter(!year %in% c(recordings$year, surveys$year)) %>%
bind_rows(surveys) %>%
arrange(year)
rec.year = cbind(recordings[,'year'],1) # whether a recording was made this year
rec.year = rbind(rec.year,cbind(surveys[,'year'],0))
rec.year = rec.year[order(rec.year[,1]),]
rec.year
surveys[,'year']
surveys[,'year'],0
recordings
all_years<-passive_surveys %>%
filter(!year %in% c(recordings$year, surveys$year)) %>%
bind_rows(surveys) %>%
arrange(year)
surveys[,'year'],0
surveys[,'year']
cbind(surveys[,'year'],0)
recordings$year
ifelse(year %in% recordings$year, 1, 0)
record_years<-tible(
year=all_years$year,
record=ifelse(year %in% recordings$year, 1, 0)
)
record_years<-tibble(
year=all_years$year,
record=ifelse(year %in% recordings$year, 1, 0)
)
record_years
recordings$year
all_years$year %in% recordings$year
surveys
sort(unique(recordings$year, all_years$year))
record_years<-tibble(
year=sort(unique(recordings$year, all_years$year)),
record=ifelse(all_years %in% recordings$year, 1, 0)
)
record_years<-tibble(
year=sort(unique(recordings$year, all_years$year)),
record=ifelse(years %in% recordings$year, 1, 0)
)
sort(unique(recordings$year, all_years$year))
sort(unique(c(recordings$year, all_years$year)))
record_years<-tibble(
year=sort(unique(c(recordings$year, all_years$year))),
record=ifelse(years %in% recordings$year, 1, 0)
)
record_years
recordings
# set species working directory
setwd("~/Documents/git_projects/extinct/")
library(tidyverse)
# load functions
source("./_functions_thompson_et_al.R")
# load data files for recordings and surveys
recordings <- read_csv("./c_maridadi/recordings.csv")
surveys <- read_csv("./c_maridadi/surveys.csv")
passive_surveys<- tibble(
year = min(recordings$year, surveys$year):max(recordings$year, surveys$year),
eps_lower=0.01,
eps_upper=0.05,
pi_lower=0.7,
pi_upper=0.95,
pr_lower=0.7,
pr_upper=0.95
)
# set species working directory
setwd("~/Documents/git_projects/extinct/")
library(tidyverse)
# load functions
source("./_functions_thompson_et_al.R")
# load data files for recordings and surveys
recordings <- read_csv("./c_maridadi/recordings.csv")
surveys <- read_csv("./c_maridadi/surveys.csv")
passive_surveys<- tibble(
year = min(recordings$year, surveys$year):max(recordings$year, surveys$year),
eps_lower=0.01,
eps_upper=0.05,
pi_lower=0.7,
pi_upper=0.95,
pr_lower=0.7,
pr_upper=0.95
)
all_years<-passive_surveys %>%
filter(!year %in% c(recordings$year, surveys$year)) %>%
bind_rows(surveys) %>%
arrange(year)
record_years<-tibble(
year=sort(unique(c(recordings$year, all_years$year))),
record=ifelse(years %in% recordings$year, 1, 0)
)
years
record_years<-tibble(
year=sort(unique(c(recordings$year, all_years$year))),
record=ifelse(year %in% recordings$year, 1, 0)
)
record_years
## run model
PXt= px.mid(recordings=recordings) ### NOTE: FIRST SURVEY YEAR NEEDS TO OCCUR AFTER THE FIRST RECORD!!!
# load functions
source("./_functions_thompson_et_al.R")
View(px.mid)
surveys
recordings
as.matrix(recordings)
surveys=as.matrix(surveys)
####################################################################################################
## Implementation of a model to estimate extinction probability from threats, records and surveys
## Colin J. Thompson, Vira Koshkina, Mark A. Burgman, Stuart H. M. Butchart and Lewi Stone
## R code Appendix
#####################################################################################################
## Sampling of the values, counting st dev then setting
require(stats)# function for calculating mid-range values -------------------------
pxt.recording=function(pci,pxt){pci+(1-pci)*pxt}
pxt.survey=function(eps, pi, pr, pxt){(1-eps*pi*pr)*pxt}
px.mid = function(recordings,surveys)
{
# convert input to matrices
recordings=as.matrix(recordings)
surveys=as.matrix(surveys)
PXt = NULL
PXt.min = NULL
PXt.max = NULL
sd=NULL
PX0 = 1 # species is extant at year 0 P(X0)=1
# first year t=1
rec = recordings[recordings[,1]==years[1],]
pci.mid = (rec[,2] + rec[,3]) / 2
pci.min=rec[,2]
pci.max=rec[,3]
PXt[1]=pxt.recording(pci.mid, PX0)
PXt.min[1]=pxt.recording(pci.min, PX0)
PXt.max[1]=pxt.recording(pci.max, PX0)
n=10000 #number of samples
pxt.sam=rep(PX0,n)
stdev=(rec[,3] - rec[,2])/4
pci.sam = rnorm(n,pci.mid,stdev )
pxt.sam = pxt.recording(pci.sam, pxt.sam)
sd[1]=sd(pxt.sam)
for (t in 2:length(years)) {
#calculating rj
if (rec.year[t,2]) #if recording
{
rec = recordings[recordings[,1]==years[t],]
#get mid point estimate
pci.mid = (rec[,2] + rec[,3]) / 2
pci.min=rec[,2]
pci.max=rec[,3]
PXt[t]=pxt.recording(pci.mid, PXt[t-1])
PXt.min[t]=pxt.recording(pci.min, PXt.min[t-1])
PXt.max[t]=pxt.recording(pci.max, PXt.max[t-1])
#sample to get min and max bounds
stdev=(rec[,3] - rec[,2])/4
pci.sam = rnorm(n,pci.mid,stdev )
pxt.sam = pxt.recording(pci.sam, pxt.sam)
sd[t]=sd(pxt.sam)
}  else #if survey
{
sur=surveys[surveys[,1]==years[t],]
eps.mid = (sur[,2] + sur[,3]) / 2
pi.mid = (sur[,4] + sur[,5]) / 2
pr.mid = (sur[,6] + sur[,7]) / 2
eps.min = sur[,2]
pi.min = sur[,4]
pr.min = sur[,6]
eps.max = sur[,3]
pi.max = sur[,5]
pr.max = sur[,7]
PXt[t]=pxt.survey(eps.mid, pi.mid, pr.mid, PXt[t-1])
PXt.min[t] = pxt.survey(eps.max, pi.max, pr.max, PXt.min[t - 1])
PXt.max[t] = pxt.survey(eps.min, pi.min, pr.min, PXt.max[t - 1])
eps.sam = rnorm(n,eps.mid,(sur[,3] - sur[,2]) / 4)
pi.sam = rnorm(n,pi.mid,(sur[,5] - sur[,4]) / 4)
pr.sam = rnorm(n,pi.mid,(sur[,7] - sur[,6]) / 4)
pxt.sam = pxt.survey(eps.sam, pi.sam, pr.sam, pxt.sam)
sd[t]=sd(pxt.sam)
}
}
# print(cbind(PXt-3*sd,PXt,PXt+3*sd))
return (cbind(PXt-3*sd,PXt,PXt+3*sd, PXt.min, PXt.max))
}
## run model
PXt= px.mid(recordings=recordings) ### NOTE: FIRST SURVEY YEAR NEEDS TO OCCUR AFTER THE FIRST RECORD!!!
## run model
PXt= px.mid(recordings=recordings, surveys = surveys) ### NOTE: FIRST SURVEY YEAR NEEDS TO OCCUR AFTER THE FIRST RECORD!!!
surveys
recordings
View(all_years)
# set species working directory
setwd("~/Documents/git_projects/extinct/")
# load functions
source("./_functions_thompson_et_al.R")
# load data files for recordings and surveys
recordings <- read.csv("./c_maridadi/recordings.csv")
surveys <- read.csv("./c_maridadi/surveys.csv")
# data for passive surveys
#data for passive surveys
pi = c(0.06, 0.14)
eps.passive = c(0.01,	0.05)
pi.passive = c(0.7,	0.95)
pr.passive = c(0.7,	0.95)
pas.sur = c(eps.passive ,pi.passive,pr.passive)
#total number of years
years = seq(min(recordings[,'year'],surveys[,'year']),max(recordings[,'year'],surveys[,'year']),by =
1)
years
# create range of years
min_year=min(c(recordings$year, surveys$year))
max=year=max(c(recordings$year, surveys$year))
max_year=max(c(recordings$year, surveys$year))
years=min_year:max_year
# set species working directory
setwd("~/Documents/git_projects/extinct/")
library(tidyverse)
# load functions
source("./_functions_thompson_et_al.R")
# load data files for recordings and surveys
recordings <- read_csv("./c_maridadi/recordings.csv")
surveys <- read_csv("./c_maridadi/surveys.csv")
passive_surveys<- tibble(
year = min(recordings$year, surveys$year):max(recordings$year, surveys$year),
eps_lower=0.01,
eps_upper=0.05,
pi_lower=0.7,
pi_upper=0.95,
pr_lower=0.7,
pr_upper=0.95
)
all_years<-passive_surveys %>%
filter(!year %in% c(recordings$year, surveys$year)) %>%
bind_rows(surveys) %>%
arrange(year)
record_years<-tibble(
year=sort(unique(c(recordings$year, all_years$year))),
record=ifelse(year %in% recordings$year, 1, 0)
)
## run model
PXt= px.mid(recordings=recordings, surveys = surveys) ### NOTE: FIRST SURVEY YEAR NEEDS TO OCCUR AFTER THE FIRST RECORD!!!
